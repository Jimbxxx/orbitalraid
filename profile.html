<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profile - Orbital Raid</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      min-height: 100vh;
      margin: 0;
      font-family: 'Arial', sans-serif;
      color: #00ffcc;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px 20px;
    }
    .neon-text {
      text-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc;
    }
    .card {
      background: rgba(0, 255, 204, 0.1);
      border: 1px solid #00ffcc;
      border-radius: 1rem;
      box-shadow: 0 0 15px #00ffcc50;
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 0 30px #00ffcc, 0 0 40px #00ffccaa;
      transform: translateY(-5px);
    }
    /* Fade in animation */
    .fade-in {
      animation: fadeIn 1s ease forwards;
      opacity: 0;
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    /* Spinner */
    .spinner {
      border: 4px solid rgba(0, 255, 204, 0.2);
      border-top: 4px solid #00ffcc;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    /* Button cool hover */
    button:hover {
      filter: drop-shadow(0 0 10px #00ffcc);
    }
    img.profile-pic {
      border-radius: 50%;
      max-width: 100px;
      max-height: 100px;
      border: 2px solid #00ffcc;
      margin-top: 10px;
    }
  </style>
</head>
<body>
    <header
    class="bg-gray-900/80 p-6 text-center shadow-[0_0_15px_#00ffcc] fixed w-full top-0 z-10"
  >
    <h1 class="text-5xl font-extrabold neon-text">ORBITAL RAID</h1>
    <!-- IMPORTANT: added id="navbar" -->
    <nav id="navbar" class="mt-6">
      <a
        href="index.html"
        class="text-2xl text-teal-300 hover:text-teal-100 mx-6 transition-all hover:scale-110"
        >Home</a
      >
      <a
        href="signin.html"
        class="text-2xl text-teal-300 hover:text-teal-100 mx-6 transition-all hover:scale-110"
        >Sign In</a
      >
      <a
        href="register.html"
        class="text-2xl text-teal-300 hover:text-teal-100 mx-6 transition-all hover:scale-110"
        >Register</a
      >
    </nav>
  </header>
  <div class="w-full max-w-3xl p-8 space-y-8 pt-[7rem]">


  <div class="w-full max-w-3xl p-8 space-y-8">

    <h1 class="text-5xl font-extrabold neon-text text-center mb-6 fade-in">Profile Settings</h1>

    <div id="loading" class="spinner"></div>

    <!-- Profile Info -->
    <section id="profile-info" class="card p-6 fade-in hidden">
      <h2 class="text-3xl font-bold mb-4 neon-text flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="#00ffcc" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5.121 17.804A9 9 0 1118.879 6.196M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        Your Profile
      </h2>
      <p><strong>Email:</strong> <span id="user-email" class="text-teal-300"></span></p>
      <p><strong>Username:</strong> <span id="user-username" class="text-teal-300"></span></p>
      <div>
        <strong>Profile Picture:</strong><br />
        <img id="profile-pic-img" class="profile-pic" src="" alt="Profile Picture" />
      </div>
    </section>

    <!-- Change Username -->
    <section id="change-username" class="card p-6 fade-in hidden">
      <h2 class="text-3xl font-bold mb-4 neon-text flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="#00ffcc" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10c0 1.105.895 2 2 2h8c1.105 0 2-.895 2-2V7M16 3H8a2 2 0 00-2 2v2h12V5a2 2 0 00-2-2z" /></svg>
        Change Username
      </h2>
      <form id="username-form" class="space-y-4">
        <input type="text" id="new-username" placeholder="New username" required
          class="w-full p-3 rounded-lg bg-gray-900 text-teal-300 border border-teal-300 focus:outline-none focus:ring-2 focus:ring-teal-300"/>
        <button type="submit" class="w-full bg-teal-400 hover:bg-teal-600 text-gray-900 font-bold py-3 rounded-lg transition">Update Username</button>
      </form>
    </section>

    <!-- Update Profile Picture URL -->
    <section id="update-photo" class="card p-6 fade-in hidden">
      <h2 class="text-3xl font-bold mb-4 neon-text flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="#00ffcc" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M2 20h20" /></svg>
        Update Profile Picture URL
      </h2>
      <form id="photo-form" class="space-y-4">
        <input type="url" id="new-photo-url" placeholder="New profile picture URL"
          class="w-full p-3 rounded-lg bg-gray-900 text-teal-300 border border-teal-300 focus:outline-none focus:ring-2 focus:ring-teal-300"/>
        <button type="submit" class="w-full bg-teal-400 hover:bg-teal-600 text-gray-900 font-bold py-3 rounded-lg transition">Update Photo</button>
      </form>
    </section>

    <!-- Reset Password -->
    <section id="reset-password" class="card p-6 fade-in hidden">
      <h2 class="text-3xl font-bold mb-4 neon-text flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="#00ffcc" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 11c.667 0 2-1 2-1s1.333 1 2 1 2 1 2 1-1.333 1-2 1-2-1-2-1-1.333 1-2 1-2-1-2-1 1.333-1 2-1z" /></svg>
        Reset Password
      </h2>
      <form id="password-form" class="space-y-4">
        <input type="email" id="reset-email" placeholder="Email address" required
          class="w-full p-3 rounded-lg bg-gray-900 text-teal-300 border border-teal-300 focus:outline-none focus:ring-2 focus:ring-teal-300"/>
        <button type="submit" class="w-full bg-teal-400 hover:bg-teal-600 text-gray-900 font-bold py-3 rounded-lg transition">Send Reset Email</button>
      </form>
    </section>

    <!-- Delete Account -->
    <section id="delete-account" class="card p-6 fade-in hidden">
      <h2 class="text-3xl font-bold mb-4 neon-text flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="#ff0066" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4m-4 0a1 1 0 00-1 1v1h6V4a1 1 0 00-1-1m-4 0h4" /></svg>
        Delete Account
      </h2>
      <button id="delete-button" class="w-full bg-red-600 hover:bg-red-800 text-white font-bold py-3 rounded-lg transition">Delete My Account</button>
    </section>

  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
    import {
      getAuth, onAuthStateChanged,
      updateProfile,
      sendPasswordResetEmail,
      deleteUser, signOut
    } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBHSvsU8959UOsPrJKLfPLDDKzzXer-eco",
      authDomain: "orbital-raid-data.firebaseapp.com",
      projectId: "orbital-raid-data",
      storageBucket: "orbital-raid-data.appspot.com",
      messagingSenderId: "1026103707268",
      appId: "1:1026103707268:web:82aadea2cd5765599824d1"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Elements
    const loadingEl = document.getElementById('loading');
    const profileInfoEl = document.getElementById('profile-info');
    const userEmailEl = document.getElementById('user-email');
    const userUsernameEl = document.getElementById('user-username');
    const profilePicImg = document.getElementById('profile-pic-img');

    const changeUsernameSection = document.getElementById('change-username');
    const updatePhotoSection = document.getElementById('update-photo');
    const resetPasswordSection = document.getElementById('reset-password');
    const deleteAccountSection = document.getElementById('delete-account');

    // Show profile info after auth
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "signin.html";
        return;
      }
      loadingEl.style.display = 'none';
      profileInfoEl.classList.remove('hidden');
      changeUsernameSection.classList.remove('hidden');
      updatePhotoSection.classList.remove('hidden');
      resetPasswordSection.classList.remove('hidden');
      deleteAccountSection.classList.remove('hidden');

      userEmailEl.textContent = user.email || "(no email)";
      userUsernameEl.textContent = user.displayName || "(no username)";
      profilePicImg.src = user.photoURL || "https://via.placeholder.com/100?text=No+Photo";
    });

    // Update username
    document.getElementById('username-form').addEventListener('submit', async e => {
      e.preventDefault();
      const newUsername = document.getElementById('new-username').value.trim();
      if (!newUsername) {
        alert("Please enter a username");
        return;
      }
      try {
        await updateProfile(auth.currentUser, { displayName: newUsername });
        userUsernameEl.textContent = newUsername;
        alert("Username updated successfully");
        e.target.reset();
      } catch (error) {
        alert("Error updating username: " + error.message);
      }
    });

    // Update profile photo URL
    document.getElementById('photo-form').addEventListener('submit', async e => {
      e.preventDefault();
      const newPhotoURL = document.getElementById('new-photo-url').value.trim();
      if (!newPhotoURL) {
        alert("Please enter a valid URL");
        return;
      }
      try {
        await updateProfile(auth.currentUser, { photoURL: newPhotoURL });
        profilePicImg.src = newPhotoURL;
        alert("Profile picture updated successfully");
        e.target.reset();
      } catch (error) {
        alert("Error updating profile picture: " + error.message);
      }
    });

    // Send password reset email
    document.getElementById('password-form').addEventListener('submit', async e => {
      e.preventDefault();
      const resetEmail = document.getElementById('reset-email').value.trim();
      if (!resetEmail) {
        alert("Please enter your email");
        return;
      }
      try {
        await sendPasswordResetEmail(auth, resetEmail);
        alert("Password reset email sent");
        e.target.reset();
      } catch (error) {
        alert("Error sending password reset email: " + error.message);
      }
    });

    // Delete account
    document.getElementById('delete-button').addEventListener('click', async () => {
      if (!confirm("Are you sure you want to delete your account? This action cannot be undone.")) return;
      try {
        await deleteUser(auth.currentUser);
        alert("Account deleted successfully");
        await signOut(auth);
        window.location.href = "index.html";
      } catch (error) {
        alert("Error deleting account: " + error.message);
      }
    });
  </script>
</body>
</html>
